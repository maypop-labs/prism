# PRISM Script Summaries

## Script 01 - Loading, Aggregation, and Quality Control
This script loads single-cell RNA sequencing data from 10X Genomics CellRanger output for multiple biological donors, performs optional doublet detection using either scDblFinder or DoubletFinder to remove artifactual cell multiplets, applies quality control filters based on mitochondrial gene percentage and feature counts, and then merges all donor datasets into a single Seurat object. The merged dataset undergoes standard Seurat v5 preprocessing including log-normalization, variable feature selection, PCA dimensionality reduction, and UMAP embedding, followed by donor-level integration using canonical correlation analysis (CCA) to remove batch effects while preserving biological variation. The script outputs PCA and UMAP plots colored by donor age, saves the integrated Seurat object for downstream analysis, and provides comprehensive doublet detection statistics if enabled.

## Script 02 - Cell Type Identification
This script loads the merged Seurat object from Script 01, performs automated cell type annotation using SingleR with an organism-appropriate reference database, and then implements a critical donor normalization strategy to ensure perfectly balanced donor representation within each cell type. The normalization uses actual minimum donor counts rather than artificial caps to achieve perfect balance, and cell types that fail to achieve perfect balance across all donors are excluded from further analysis to prevent donor-specific biases in downstream pseudotime and attractor analyses. For each cell type that passes normalization, the script creates a separate Seurat object, performs cell-type-specific dimensionality reduction (PCA and UMAP), and saves both the processed objects and visualization plots. The script also generates summary statistics showing pre- and post-normalization donor distributions, saves a list of retained cell types, and creates frequency tables documenting the total number of cells per cell type after filtering.

## Script 03 - Pseudotime
This script converts a cell-type-specific Seurat object to Monocle3's CellDataSet format, performs trajectory inference by rooting the pseudotime analysis from the youngest donor's cells (representing the earliest cellular state in the aging process), identifies all trajectory branches emanating from this root, and validates each branch by calculating Spearman correlations between pseudotime and donor chronological age. Only branches exceeding a critical correlation threshold (r ≥ 0.3, p < 0.05) are retained, as this threshold represents the minimum signal-to-noise ratio where aging effects dominate over non-aging factors in the trajectory. For each valid branch, the script saves a separate CellDataSet containing only cells along that trajectory path, creates age-versus-pseudotime plots showing the correlation strength, and generates a comprehensive branch statistics report documenting correlations, p-values, cell counts, and donor representation. If no trajectories meet the threshold, the script provides detailed diagnostic information and suggestions for adjusting parameters rather than proceeding with invalid trajectories.

## Script 04 - GeneSwitches
This script applies the GeneSwitches package to identify genes that exhibit switch-like expression transitions along pseudotime trajectories, using logistic regression models to characterize the timing and direction of these transitions. The analysis operates on the raw count data converted to a binary expression matrix, either through mixture model binarization (which adaptively determines thresholds per gene) or fixed cutoff binarization as a fallback, with the goal of identifying genes whose expression patterns follow sigmoid-like curves characteristic of cellular state transitions. The GeneSwitches approach models each gene's expression as a logistic function of pseudotime, estimating parameters including switch timing, direction (upregulation or downregulation), and fit quality (pseudo-R²), then filters results by false discovery rate to retain only statistically significant switch genes. The script saves both the complete GeneSwitches results object and a curated TSV report containing gene identifiers, switch directions, FDR values, pseudotime coordinates, and model fit statistics, providing the foundation for subsequent Boolean network construction by identifying genes whose binary states are meaningful along the aging trajectory.

## Script 05 - GRN
This script constructs a gene regulatory network by integrating SCENIC's GENIE3 random forest predictions with RcisTarget's transcription factor binding motif enrichment analysis, creating biologically grounded regulatory relationships between genes identified as switches in Script 04. The pipeline uses GENIE3 to predict potential regulatory interactions based on co-expression patterns across cells, validates these predictions using RcisTarget to confirm transcription factor binding motif enrichment in target gene promoters, and then filters the resulting network to focus on relationships involving switch genes from the trajectory. The analysis includes a checkpoint recovery system to handle the extremely long runtime (often >14 hours for new trajectories), storing intermediate results in the `int/` directory that enable resuming from the last successful stage if the process is interrupted. The script correlates binarized expression patterns between regulators and targets to quantify relationship strength, incorporates SCENIC metadata including regulatory direction (activation/repression) and motif confidence scores, and outputs a comprehensive edge list representing the gene regulatory network that will be converted into Boolean rules in the next script.

## Script 06 - Boolean Regulation
This script transforms the SCENIC-derived gene regulatory network from Script 05 into executable Boolean logic rules by systematically testing template-based rule combinations and selecting optimal rules based on empirical fit to the binary expression data. The core algorithm sanitizes gene names for BoolNet compatibility, selects optimal regulators for each target gene using SCENIC metadata (correlation strength, regulatory direction, motif confidence), and applies a multi-method inference strategy that exhaustively tests logical combinations (AND, OR, NOT operators) of up to k regulators to find rules that best predict the target gene's binary expression pattern along the pseudotime-ordered cells. Each rule receives a quality score based on prediction accuracy, consistency with SCENIC-indicated regulatory signs (activation vs. repression), and motif evidence, with intelligent fallbacks (including self-activation rules) for genes lacking strong regulatory evidence to ensure complete network coverage. The script validates all rules for BoolNet syntax compatibility, generates comprehensive quality reports including method breakdowns and score distributions, and outputs multiple formats including a detailed rule analysis table, a flat regulator table for compatibility, and the complete rule set object that will be loaded into BoolNet in Script 07 to identify network attractors.

## Script 07 - BoolNet
This script creates an executable Boolean network from the validated rules generated in Script 06, loads the network into BoolNet's synchronous Boolean dynamics framework, and identifies attractor states representing stable cellular configurations that the network gravitates toward from different initial conditions. The script chooses between exhaustive state space exploration (for networks ≤29 genes, which guarantees finding all attractors) or adaptive random sampling (for larger networks, scaling sample size with network complexity) to identify attractors, which can be either point attractors (steady states where no genes change) or cycle attractors (oscillating patterns of gene expression). For each identified attractor, BoolNet computes basin of attraction statistics indicating what fraction of possible initial states eventually reach that attractor, providing a measure of attractor stability and dominance in the network's state space. The script outputs the complete BoolNet network object, the attractor information structure containing encoded state representations and basin statistics, and a comprehensive analysis report documenting total genes, number of attractors by type, maximum attractor size, and the analysis method used, which serves as the foundation for computing aging scores and testing perturbations in Script 08.

## Script 08 - Attractor Analysis
This script performs a comprehensive five-part analysis to identify gene perturbation targets capable of reversing cellular aging signatures by measuring how knockdowns and overexpressions shift the Boolean network's attractor landscape toward more youthful states. Part 1 computes age scores for each attractor by projecting the attractor's binary gene expression pattern onto a young-old reference axis derived from the 20% youngest and oldest cells in the pseudotime trajectory, quantifying how "young-like" or "old-like" each attractor state appears. Part 2 calculates attractor stability through entropy analysis and weights attractors by basin size to compute an overall network aging score, representing the probability-weighted aging bias of the entire network's attractor landscape. Part 3 systematically tests single-gene perturbations by fixing each gene to 0 (knockdown) or 1 (overexpression), recalculating the network's attractor landscape and aging score for each perturbation, and identifying interventions that reduce the aging score by shifting attractors toward younger configurations. Part 4 ranks all perturbation results by aging score reduction (delta), creates comprehensive target tables combining knockdown and overexpression results, and generates pivot tables showing the best intervention mode for each gene. Part 5 extends the analysis to double gene perturbations, testing combinations of the top single-gene targets in double knockdown, double overexpression, and mixed configurations to identify synergistic interventions where two genes together produce greater rejuvenation effects than either alone, with all results integrated into a unified ranking system that identifies the most promising cellular rejuvenation targets.

## Script 09 - Graphs
This script generates publication-ready visualizations of the PRISM analysis results, creating a multi-dimensional attractor landscape plot that displays aging scores, basin sizes, stability metrics, and composite aging contributions as bubble plots to reveal which attractors dominate the network and bias it toward aged states. The script loads perturbation results from Script 08 and creates bar plots showing the top 20 single-gene interventions ranked by aging score reduction, with color coding to distinguish knockdowns from overexpressions and visual indicators for significant versus moderate improvements. For networks where double perturbation analysis was performed, the script generates additional plots displaying the top 15 gene pair combinations, visually comparing double knockdowns, double overexpressions, and mixed interventions to highlight synergistic effects. All plots use a consistent publication theme with proper axis labels, legends, and captions, save as high-resolution PNG files organized by cell type and trajectory, and employ color schemes that clearly communicate which interventions reduce aging (improvements in green/blue) versus those that increase it (red), providing researchers with immediate visual access to the most promising rejuvenation targets identified by the Boolean network perturbation analysis.

## Script 10 - Switch Gene Regulatory Report
This script extracts and synthesizes regulatory relationships between switch genes identified in Script 04 by parsing the Boolean rules constructed in Script 06, creating a comprehensive report that documents each switch gene's properties and its role as a transcription factor regulating other switch genes. For each switch gene, the script retrieves its expression direction (upregulation or downregulation during aging), pseudotime coordinate where the switch occurs, and statistical significance metrics from the GeneSwitches analysis. The script then parses the Boolean logic rules to identify which other switch genes each gene regulates, determining whether each regulatory relationship represents activation (gene appears without negation in the rule) or repression (gene appears with negation operator). The output is organized as a TSV report with one row per switch gene, sorted by pseudotime coordinate to reveal the temporal ordering of regulatory events along the aging trajectory. This report bridges the gap between individual switch gene identification and network-level regulatory logic, providing researchers with a clear view of which aging-associated genes control other aging-associated genes and facilitating the identification of upstream master regulators versus downstream effectors in the aging regulatory cascade.
